<!DOCTYPE html>
<html>
<head>
    <title>Audio2Face SDK Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        h1 { color: #00d4ff; }
        .status {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            background: #0f3460;
            font-family: monospace;
        }
        .status.error { background: #5c1a1a; color: #ff6b6b; }
        .status.success { background: #1a5c1a; color: #6bff6b; }
        .status.loading { background: #5c4a1a; color: #ffd36b; }
        .results {
            background: #16213e;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .blendshape-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #0f3460;
        }
        .value { color: #00d4ff; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Audio2Face SDK Test</h1>
    <div id="status" class="status loading">Loading SDK and model...</div>
    <div id="results" class="results" style="display: none;"></div>
    
    <script src="onnxruntime-web.min.js"></script>
    <script type="module">
        import { Audio2FaceSDK } from './audio2face-sdk-browser.js';
        
        const status = document.getElementById('status');
        const results = document.getElementById('results');
        
        async function runTest() {
            try {
                const sdk = new Audio2FaceSDK();
                
                status.textContent = 'Fetching model file...';
                const response = await fetch('network_actual.onnx');
                if (!response.ok) {
                    throw new Error('Model file not found. Please ensure network_actual.onnx exists.');
                }
                const modelBlob = await response.blob();
                
                status.textContent = 'Loading model...';
                await sdk.loadModel(modelBlob, { useGPU: false });
                
                status.textContent = 'Running inference test with synthetic audio...';
                const testAudio = new Float32Array(8320);
                for (let i = 0; i < 8320; i++) {
                    testAudio[i] = Math.sin(i * 0.1) * 0.5;
                }
                
                const result = await sdk.processAudioChunk(testAudio);
                
                results.innerHTML = `
                    <h3>Test Results</h3>
                    <p><strong>Blendshapes detected:</strong> ${result.blendshapes.length}</p>
                    <p><strong>First 5 values:</strong></p>
                    ${result.blendshapes.slice(0, 5).map(bs => `
                        <div class="blendshape-item">
                            <span>${bs.name}</span>
                            <span class="value">${bs.value.toFixed(4)}</span>
                        </div>
                    `).join('')}
                    <p style="margin-top: 20px;"><strong>Jaw value:</strong> <span class="value">${result.jaw.toFixed(4)}</span></p>
                    <p><strong>Timestamp:</strong> ${result.timestamp}</p>
                `;
                results.style.display = 'block';
                
                status.textContent = 'All tests passed successfully!';
                status.className = 'status success';
            } catch (err) {
                status.textContent = 'Error: ' + err.message;
                status.className = 'status error';
                console.error(err);
            }
        }
        
        runTest();
    </script>
</body>
</html>